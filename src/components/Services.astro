---
import Container from "./ui/Container.astro";
import SectionHeading from "./ui/SectionHeading.astro";
import Button from "./ui/Button.astro";

const services = [
  {
    image: "/images/sections/alarm-panel.jpg",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>`,
    title: "Home Security – Alarm Systems",
    description:
      "Protect your family with advanced alarm systems designed to keep your home safe and secure.",
  },
  {
    image: "/images/sections/access-control.jpg",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>`,
    title: "Business Security – Access Control",
    description:
      "Ensure only authorized personnel enter your facilities with reliable access control solutions.",
  },
  {
    image: "/images/sections/fire-alarm.jpg",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" /><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z" /></svg>`,
    title: "Fire Alarm Systems – Fire Protection",
    description:
      "Stay compliant and protected with certified fire alarm systems that detect and respond instantly.",
  },
  {
    image: "/images/sections/shield-lock.jpg",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11" /></svg>`,
    title: "Card Access Systems – Sophisticated Security",
    description:
      "Upgrade to fingerprint and card access technology for seamless, modern protection.",
  },
  {
    image: "/images/sections/smart-home.jpg",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>`,
    title: "Total Connect Systems – Mobile Control",
    description:
      "Manage your security anytime, anywhere with smart mobile control integration.",
  },
  {
    image: "/images/sections/security-camera.jpg",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>`,
    title: "CCTV – Surveillance",
    description:
      "Monitor every angle with high-definition CCTV cameras built for reliability and clarity.",
  },
];
---

<section id="services" class="bg-bg-alt py-20 sm:py-28">
  <Container>
    <SectionHeading
      title="Our Security Services"
      subtitle="Comprehensive protection tailored to your needs."
    />

    <!-- Mobile slider -->
    <div class="sm:hidden">
      <div class="services-slider flex gap-4 overflow-x-auto scroll-smooth snap-x snap-mandatory pb-4">
        <div class="min-w-[7.5%] shrink-0" aria-hidden="true" />
        {
          services.map((service, i) => (
            <div class="reveal min-w-[85%] snap-center" data-delay={i * 80}>
              <div class="group overflow-hidden rounded-2xl border border-gray-200 bg-white transition-all duration-300 hover:shadow-xl hover:border-accent/20">
                <div class="relative h-48 overflow-hidden">
                  <img
                    src={service.image}
                    alt={service.title}
                    class="h-full w-full object-cover"
                    loading="lazy"
                  />
                  <div class="absolute inset-0 bg-gradient-to-t from-dark/60 to-transparent" />
                  <div class="absolute bottom-3 left-3 flex h-10 w-10 items-center justify-center rounded-lg bg-accent" set:html={service.icon} />
                </div>
                <div class="p-6">
                  <h3 class="mb-2 text-lg font-semibold text-dark">
                    {service.title}
                  </h3>
                  <p class="mb-5 text-sm text-text-light leading-relaxed">
                    {service.description}
                  </p>
                  <Button
                    href="#contact"
                    variant="outline"
                    class="!px-4 !py-2 !text-xs"
                  >
                    Get a free quote
                  </Button>
                </div>
              </div>
            </div>
          ))
        }
        <div class="min-w-[7.5%] shrink-0" aria-hidden="true" />
      </div>
      <!-- Dot indicators -->
      <div class="flex justify-center gap-2 mt-4">
        {services.map((_, i) => (
          <button
            class="services-dot h-2 w-2 rounded-full bg-gray-300 transition-colors duration-300"
            data-index={i}
            aria-label={`Go to service ${i + 1}`}
          />
        ))}
      </div>
    </div>

    <!-- Desktop/tablet grid -->
    <div class="hidden sm:grid grid-cols-2 gap-6 lg:grid-cols-3">
      {
        services.map((service, i) => (
          <div class="reveal" data-delay={i * 80}>
            <div class="group overflow-hidden rounded-2xl border border-gray-200 bg-white transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:border-accent/20">
              <div class="relative h-48 overflow-hidden">
                <img
                  src={service.image}
                  alt={service.title}
                  class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-dark/60 to-transparent" />
                <div class="absolute bottom-3 left-3 flex h-10 w-10 items-center justify-center rounded-lg bg-accent" set:html={service.icon} />
              </div>
              <div class="p-6">
                <h3 class="mb-2 text-lg font-semibold text-dark">
                  {service.title}
                </h3>
                <p class="mb-5 text-sm text-text-light leading-relaxed">
                  {service.description}
                </p>
                <Button
                  href="#contact"
                  variant="outline"
                  class="!px-4 !py-2 !text-xs"
                >
                  Get a free quote
                </Button>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </Container>
</section>

<style>
  .services-slider {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .services-slider::-webkit-scrollbar {
    display: none;
  }
</style>

<script>
  function initServicesSlider() {
    const slider = document.querySelector<HTMLElement>(".services-slider");
    const dots = document.querySelectorAll<HTMLElement>(".services-dot");
    if (!slider || !dots.length) return;

    function updateDots() {
      const cards = slider!.querySelectorAll<HTMLElement>(".snap-center");
      const scrollLeft = slider!.scrollLeft;
      const cardWidth = cards[0]?.offsetWidth || 1;
      const gap = 16;
      const activeIndex = Math.round(scrollLeft / (cardWidth + gap));

      dots.forEach((dot, i) => {
        if (i === activeIndex) {
          dot.classList.remove("bg-gray-300");
          dot.classList.add("bg-accent");
        } else {
          dot.classList.remove("bg-accent");
          dot.classList.add("bg-gray-300");
        }
      });
    }

    dots.forEach((dot) => {
      dot.addEventListener("click", () => {
        const index = parseInt(dot.dataset.index || "0", 10);
        const cards = slider!.querySelectorAll<HTMLElement>(".snap-center");
        const card = cards[index];
        if (card) {
          slider!.scrollTo({ left: card.offsetLeft - slider!.offsetLeft, behavior: "smooth" });
        }
      });
    });

    slider.addEventListener("scroll", updateDots, { passive: true });
    updateDots();
  }

  document.addEventListener("DOMContentLoaded", initServicesSlider);
  document.addEventListener("astro:page-load", initServicesSlider);
</script>
